@model IEnumerable<MvcMovie.Models.Inscription>
@using System.Text

@{
    ViewData["Title"] = "Liste des Inscriptions";
}

<div class="container mt-4">

    <h2 class="mb-4 text-white">üìã Liste des Inscriptions</h2>

    @if (Model == null || !Model.Any())
    {
        <p class="text-light">Aucune inscription pour le moment.</p>
    }
    else
    {
        <table class="table table-striped table-dark">
            <thead>
                <tr>
                    <th class="text-white">Employ√©</th>
                    <th class="text-white">Formation</th>
                    <th class="text-white">Date d'inscription</th>
                    <th class="text-white">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="text-white">
                            @(item.Employe != null ? $"{item.Employe.Nom} {item.Employe.Prenom}" : "‚ÑπÔ∏è Employ√© inconnu")
                        </td>
                        <td class="text-white">
                            @(item.Formation != null && !string.IsNullOrWhiteSpace(item.Formation.Titre) ? item.Formation.Titre : "‚ÑπÔ∏è Formation inconnue")
                        </td>
                        <td class="text-white">
                            @(item.DateInscription.ToString("dd/MM/yyyy"))
                        </td>
                        <td>
                            <a asp-action="Certificate" asp-route-id="@item.Id" class="btn btn-success btn-sm mb-1">
                                üéì Certificat
                            </a>

                            <form asp-action="ChangeStatus" method="post" class="d-inline">
                                <input type="hidden" name="id" value="@item.Id" />
                                <select name="statut" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
                                    @{
                                        // Construire les <option> en C# pour √©viter la restriction Razor sur les attributs
                                        var values = Enum.GetValues(typeof(MvcMovie.Models.StatutInscription))
                                                         .Cast<MvcMovie.Models.StatutInscription>();
                                        var sb = new StringBuilder();
                                        foreach (var s in values)
                                        {
                                            sb.Append("<option value=\"");
                                            sb.Append(s);
                                            sb.Append("\"");
                                            if (s == item.Statut)
                                            {
                                                sb.Append(" selected");
                                            }
                                            sb.Append(">");
                                            sb.Append(s);
                                            sb.Append("</option>");
                                        }
                                    }
                                    @Html.Raw(sb.ToString())
                                </select>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <div class="mt-3">
        <a asp-action="Create" class="btn btn-primary">
            ‚ûï Nouvelle Inscription
        </a>
    </div>

</div>